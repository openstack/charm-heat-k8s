bundle: kubernetes
applications:

  mysql:
    charm: ch:mysql-k8s
    channel: 8.0/stable
    scale: 1
    trust: false

  # Currently traefik is required for networking things.
  # If this isn't present, the units will hang at "installing agent".
  traefik:
    charm: ch:traefik-k8s
    channel: 1.0/stable
    scale: 1
    trust: true

  traefik-public:
    charm: ch:traefik-k8s
    channel: 1.0/stable
    scale: 1
    trust: true
    options:
      kubernetes-service-annotations: metallb.universe.tf/address-pool=public

  rabbitmq:
    charm: ch:rabbitmq-k8s
    channel: 3.9/edge
    scale: 1
    trust: true

  keystone:
    charm: ch:keystone-k8s
    channel: 2023.1/edge
    scale: 1
    trust: true
    options:
      admin-role: admin
    storage:
      fernet-keys: 5M
      credential-keys: 5M

  heat:
    charm: ../../heat-k8s.charm
    scale: 1
    trust: true
    resources:
      heat-api-image: docker.io/kolla/ubuntu-binary-heat-api@sha256:ca80d57606525facb404d8b0374701c02609c2ade5cb7e28ba132e666dd85949
      heat-api-cfn-image: docker.io/kolla/ubuntu-binary-heat-api-cfn@sha256:6eec5915066b55696414022c86c42360cdbd4b8b1250e06b470fee25af394b66
      heat-engine-image:  docker.io/kolla/ubuntu-binary-heat-engine@sha256:a54491f7e09eedeaa42c046cedc478f8ba78fc455a6ba285a52a5d0f8ae1df84

relations:
- - traefik:ingress
  - keystone:ingress-internal
- - traefik-public:ingress
  - keystone:ingress-public

- - mysql:database
  - keystone:database

- - mysql:database
  - heat:database
- - keystone:identity-service
  - heat:identity-service
- - traefik:ingress
  - heat:ingress-internal
- - traefik-public:ingress
  - heat:ingress-public
- - rabbitmq:amqp
  - heat:amqp

